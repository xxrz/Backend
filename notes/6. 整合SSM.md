# SSM整合

[参考](https://www.cnblogs.com/wang-sky/p/13647103.html)

项目：SSMBuilder



## 目录

[toc]

## 1. 设计流程

![image-20220513202715960](C:\Users\Lenovo\Desktop\Backend\notes\appendix\6. 整合SSM\image-20220513202715960.png)



### 1.1 需求

图书的增删改查



### 1.2 数据库

```sql
CREATE DATABASE ssmbuild;
USE ssmbuild;
CREATE TABLE `books`(
`bookID` INT NOT NULL AUTO_INCREMENT COMMENT '书id',
`bookName` VARCHAR(100) NOT NULL COMMENT '书名',
`bookCounts` INT NOT NULL COMMENT '数量',
`detail` VARCHAR(200) NOT NULL COMMENT '描述',
KEY `bookID`(`bookID`)
)ENGINE=INNODB DEFAULT CHARSET=utf8;

INSERT INTO `books`(`bookID`,`bookName`,`bookCounts`,`detail`)VALUES
(1,'Java',1,'从入门到放弃'),
(2,'MySQL',10,'从删库到跑路'),
(3,'Linux',5,'从进门到进牢');
```

database: ssmbuild(book management)

table: books

![image-20220513203502953](appendix\6. 整合SSM\image-20220513203502953.png)



### 1.3 配置依赖

pom.xml 

要注意两个问题：

- 依赖问题
- 静态资源导出问题

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.test</groupId>
    <artifactId>SSMBuild</artifactId>
    <version>1.0-SNAPSHOT</version>

    <!--依赖: junit, 数据库驱动, 连接池, servlet, jsp, mybatis, mybatis-spring, spring-->
    <dependencies>
        <!--Junit-->
        <dependency>
            <groupId>junit</groupId>
            <artifactId>junit</artifactId>
            <version>4.13</version>
        </dependency>

        <!--数据库驱动-->
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>5.1.47</version>
        </dependency>

        <!--数据库连接池:  c3p0-->
        <dependency>
            <groupId>com.mchange</groupId>
            <artifactId>c3p0</artifactId>
            <version>0.9.5.2</version>
        </dependency>

        <!--Servlet JSP jstl 标准标签库(standard)-->
        <dependency>
            <groupId>javax.servlet</groupId>
            <artifactId>servlet-api</artifactId>
            <version>2.5</version>
        </dependency>
        <dependency>
            <groupId>javax.servlet.jsp</groupId>
            <artifactId>jsp-api</artifactId>
            <version>2.2</version>
        </dependency>
        <dependency>
            <groupId>javax.servlet.jsp.jstl</groupId>
            <artifactId>jstl-api</artifactId>
            <version>1.2</version>
        </dependency>
        <dependency>
            <groupId>taglibs</groupId>
            <artifactId>standard</artifactId>
            <version>1.1.2</version>
        </dependency>

        <!--mybatis mybatis-spring-->
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis</artifactId>
            <version>3.5.5</version>
        </dependency>
        <dependency>
            <groupId>org.mybatis</groupId>
            <artifactId>mybatis-spring</artifactId>
            <version>2.0.5</version>
        </dependency>

        <!--Spring(MVC JDBC)-->
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-webmvc</artifactId>
            <version>5.2.8.RELEASE</version>
        </dependency>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-jdbc</artifactId>
            <version>5.2.8.RELEASE</version>
        </dependency>

        <!--Lombok-->
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.12</version>
        </dependency>
    </dependencies>

    <!--静态资源导出-->
    <build>
        <resources>
            <resource>
                <directory>src/main/java</directory>
                <includes>
                    <include>**/*.xml</include>
                    <include>**/*.properties</include>
                </includes>
                <filtering>false</filtering>
            </resource>

            <resource>
                <directory>src/main/resources</directory>
                <includes>
                    <include>**/*.xml</include>
                    <include>**/*.properties</include>
                </includes>
                <filtering>false</filtering>
            </resource>
        </resources>
    </build>

</project>


```



### 1.4 准备项目框架

- java目录下新建

  - dao : mapper 数据访问对象（Model）
  - pojo :  实体类
  - service : 业务（Model)
  - controller：

- 在resource目录下配置mybatis和spring的核心配置文件

  - mybatis-config.xml（mybatis）

  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE configuration
          PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
          "http://mybatis.org/dtd/mybatis-3-config.dtd">
  <configuration>
  
      <!--配置数据源, 交给Spring去做-->
  
      <!--设置别名-->
  
      <!--映射Mapper-->
  
  </configuration>
  ```

  - applicationContext.xml（spring）

  ```xml
  <?xml version="1.0" encoding="UTF-8"?>
  <beans xmlns="http://www.springframework.org/schema/beans"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://www.springframework.org/schema/beans 
         http://www.springframework.org/schema/beans/spring-beans.xsd">
  
  </beans>
  ```

- 在resource目录下写数据库的配置文件database.properties

  ```properties
  jdbc.driver = com.mysql.jdbc.Driver
  # 如果使用的是MySQL8.0+, 增加一个时区的配置: &serverTimezone=Asia/Shanghai
  jdbc.url = jdbc:mysql://localhost:3306/ssmbuild?useSSL=true&useUnicode=true&characterEncoding=utf8
  jdbc.username = root
  jdbc.password = 141592
  ```

- 其他...

  慢慢补充



## 2. SSM业务

### 2.1 Mybatis

**mybatis-config.xml的功能**

- 设置别名

- mapper映射（实体类）

  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
          <!DOCTYPE configuration
                  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
                  "http://mybatis.org/dtd/mybatis-3-config.dtd">
  <configuration>
  
      <!--配置数据源, 交给Spring去做-->
  
      <!--设置别名-->
      <!--用Books代替com.test.pojo.Books，在mapper.xml中就可以写别名-->
      <typeAliases>
          <typeAlias type="com.test.pojo.Books" alias="Books"/>
      </typeAliases>
  
  
      <!--映射Mapper-->
  
  </configuration>
  ```
  
  
  
  

#### 2.1.1 编写实体类

pojo/Books.java

因为引入了偷懒的方法，所以不用写构造函数和getter setter

```java
package com.test.pojo;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

//和数据库完全对应，字段最好和属性统一
@Data
@AllArgsConstructor
@NoArgsConstructor
public class Books {
    private int bookID;
    private String bookName;
    private int bookCounts;
    private String detail;
}
```



#### 2.1.2 Mapper(对实体类的操作)

##### 1. 定义对实体类的操作(mapper接口)

dao/BookMapper.java

```java
package com.test.dao;

import com.test.pojo.Books;
import org.apache.ibatis.annotations.Param;

import java.util.List;

public interface BookMapper {
    //增加一本书
    int addBook(Books books);

    //删除一本书
    //在SQL中引用的就是我们这里的@Param中设置的属性名
    int deleteBookById(@Param("bookId") int id);

    //更新一本书
    int updateBook(Books books);

    //查询一本书
    Books queryBookById(@Param("bookId") int id);

    //查询全部的书
    List<Books> queryAllBook();
}
```

> 注意
>
> **编写接口时, 属性为基本类型时要加上@Param("")注解, 同时此注解可以解决属性名与数据库的字段名不一致的问题**



##### 2. 实现对实体类在数据库中的操作（实现接口）

**dao/BookMapper.xml**

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--绑定接口：绑定是哪个mapper-->
<mapper namespace="com.test.dao.BookMapping">
    <insert id="addBook" parameterType="Books">
        insert into ssmbuild.books (bookName,bookCounts,detail)
        values (#{bookName},#{bookCounts},#{detail})
    </insert>

    <delete id="deleteBookById" parameterType="int">
        delete from books where bookID= #{bookId}
    </delete>

    <update id="updateBook" parameterType="Books">
        update books
        set bookName= #{bookName},bookCounts = #{bookCounts},detail=#{detail}
        where bookID=#{bookId}
    </update>

    <select id="queryBookById" parameterType="int" resultType="Books">
        select * from books
        where bookID = #{bookId}
    </select>

    <!--没有一对多和多对一 所以返回值还是Books-->
    <select id="queryAllBook" resultType="Books">
        select *
        from books;
    </select>
</mapper>
```



##### 3. mapper映射

mybatis-config.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
        <!DOCTYPE configuration
                PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
                "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>

    <!--配置数据源, 交给Spring去做-->

    <!--设置别名-->
    <typeAliases>
        <typeAlias type="com.test.pojo.Books" alias="Books"/>
    </typeAliases>


    <!--映射Mapper-->

    <mappers>
        <mapper class="com.test.dao.BookMapper"/>

    </mappers>

</configuration>
```



#### 2.1.3 业务层

##### 1. 定义业务层功能：和BookMapper对应（接口）

service/BookService.java

```java
package com.test.service;

import com.test.pojo.Books;

import java.util.List;

public interface BookService {
    //增加一本书
    int addBook(Books books);

    //删除一本书
    int deleteBookById(int id);

    //更新一本书
    int updateBook(Books books);

    //查询一本书
    Books queryBookById(int id);

    //查询全部的书
    List<Books> queryAllBook();
}

```



##### 2.实现业务层功能（实现接口）

**业务层调dao层**，组合Dao，也就是把数据填进去

service/BookServiceImpl.java

```java
package com.test.service;

import com.test.dao.BookMapper;
import com.test.pojo.Books;

import java.util.List;

public class BookServiceImpl implements BookService{

    //service 调 dao层 ：组合Dao（把数据填进去）
    private BookMapper bookMapper;

    //使用Spring
    public void setBookMapper(BookMapper bookMapper) {
        this.bookMapper = bookMapper;
    }

    @Override
    public int addBook(Books books) {
        return bookMapper.addBook(books);
    }

    @Override
    public int deleteBookById(int id) {
        return bookMapper.deleteBookById(id);
    }

    @Override
    public int updateBook(Books books) {
        return bookMapper.updateBook(books);
    }

    @Override
    public Books queryBookById(int id) {
        return bookMapper.queryBookById(id);
    }

    @Override
    public List<Books> queryAllBook() {
        return bookMapper.queryAllBook();
    }
}

```

> 注意：
>
> - dao service是MVC的model层
>
> - 此处Service层与Dao层的接口基本一致, 但是这样做实现了分层解耦, 方便之后添加一些业务
> - 在Service的实现类中, 调用dao, 同时对导入的dao编写一个Setter, 方便之后的Spring注入





### 2.2 Spring

大杂烩

就是为了整合dao(spring-dao.xml)、service(spring-service.xml)、controller(spring-mvc.xml)层



#### 2.2.1 Spring整合Dao层

spring-dao.xml

![image-20220513222638794](appendix\6. 整合SSM\image-20220513222638794.png)

> 注意：
>
> 将Spring的xml文件，都放在一个ApplicationContext中
>
> 可以在项目结构的module中配置, 也可以在applicationContext中导入
>
> - applicationContext中导入
>
>   applicationContext.xml
>
>   ```xml
>   <?xml version="1.0" encoding="UTF-8"?>
>   <beans xmlns="http://www.springframework.org/schema/beans"
>          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>          xsi:schemaLocation="http://www.springframework.org/schema/beans
>          http://www.springframework.org/schema/beans/spring-beans.xsd">
>   
>       <import resource="spring-dao.xml"/>
>       <import resource="spring-service.xml"/>
>   
>   </beans>
>   ```
>
> - spring-service.xml
>
>   ```xml
>   <import resource="classpath:spring-dao.xml"/>
>   ```



##### 1.关联数据库配置文件

```xml
 <!--1. 关联数据库配置文件-->
    <context:property-placeholder location="classpath:database.properties"/>
```



##### 2.数据连接池：c3p0

```xml
<!--2. 连接池
        dbcp: 半自动化 不能自动链接
        c3p0: 自动化 自动化的夹在配置文件 并且可以自动设置到对象中
        druid: （公司）
        hikari: （公司）Spring boot 2.0 自动

    -->
    <bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource">
        <property name="driverClass" value="${jdbc.driver}"/>
        <property name="jdbcUrl" value="${jdbc.url}"/>
        <property name="user" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>

        <!--c3p0连接池的私有属性-->
        <property name="maxPoolSize" value="30"/>
        <property name="minPoolSize" value="10"/>
        <!--关闭连接后不自动commit-->
        <property name="autoCommitOnClose" value="false"/>
        <!--获取连接超时时间-->
        <property name="checkoutTimeout" value="10000"/>
        <!--当获取失败重新尝试次数-->
        <property name="acquireRetryAttempts" value="2"/>
    </bean>
```



##### 3.创建sqlSession: SqlSessionFactory

数据连接池

```xml
<!--3. SqlSessionFactory-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <!--绑定mybatis的配置文件-->
        <property name="configLocation" value="classpath:mybatis-config.xml"/>
    </bean>
```



##### 4.自动扫描dao接口包

代替了在dao/BookMapperImpl.java中实现 UserMapper的实现类:用sqlSessionTemplate获取执行sql语句的对象

```xml
<!--本来应该还有第4步，注册sqlSessionTemple，对应mybatis里的获取sqlsession对象（用来处理sql语句）-->
    <!--4. 注册sqlSessionTemple-->
    <!--原本的做法是：dao/BookMapperImpl.java中实现 UserMapper的实现类:用sqlSessionTemplate执行sql语句-->
    <!--但我们配置dao的接口扫描包，省略了这一步，动态的实现了Dao接口可以注入的Spring容器中-->
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <!--注入 sqlFactory-->
        <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>
        <!--扫描要扫描的包，dao接口-->
        <property name="basePackage" value="com.test.dao"/>
    </bean>
```

> 注意：
>
> - 自动将dao的接口中 BookMapper注入到Spring容器中
>
> ![image-20220513231004657](appendix\6. 整合SSM\image-20220513231004657.png)
>
> - 关于Spring包扫描后的类的名字
>
> 如果连着两个大写的字母开头，则扫描进来的bean就是大写开头的；
>  如果大写开头，后面跟小写，则扫描进来的是小写开头的



##### 完整的spring-dao.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">

    <!--1. 关联数据库配置文件-->
    <context:property-placeholder location="classpath:database.properties"/>

    <!--2. 连接池
        dbcp: 半自动化 不能自动链接
        c3p0: 自动化 自动化的夹在配置文件 并且可以自动设置到对象中
        druid: （公司）
        hikari: （公司）Spring boot 2.0 自动

    -->
    <bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource">
        <property name="driverClass" value="${jdbc.driver}"/>
        <property name="jdbcUrl" value="${jdbc.url}"/>
        <property name="user" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>

        <!--c3p0连接池的私有属性-->
        <property name="maxPoolSize" value="30"/>
        <property name="minPoolSize" value="10"/>
        <!--关闭连接后不自动commit-->
        <property name="autoCommitOnClose" value="false"/>
        <!--获取连接超时时间-->
        <property name="checkoutTimeout" value="10000"/>
        <!--当获取失败重新尝试次数-->
        <property name="acquireRetryAttempts" value="2"/>
    </bean>


    <!--3. SqlSessionFactory-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
        <property name="dataSource" ref="dataSource"/>
        <!--绑定mybatis的配置文件-->
        <property name="configLocation" value="classpath:mybatis-config.xml"/>
    </bean>


    <!--本来应该还有第4步，注册sqlSessionTemple，对应mybatis里的获取sqlsession对象（用来处理sql语句）-->
    <!--4. 注册sqlSessionTemple-->
    <!--原本的做法是：dao/BookMapperImpl.java中实现 UserMapper的实现类:用sqlSessionTemplate执行sql语句-->
    <!--但我们配置dao的接口扫描包，省略了这一步，动态的实现了Dao接口可以注入的Spring容器中-->
    <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
        <!--注入 sqlFactory-->
        <property name="sqlSessionFactoryBeanName" value="sqlSessionFactory"/>
        <!--扫描要扫描的包，dao接口-->
        <property name="basePackage" value="com.test.dao"/>
    </bean>

</beans>
```



#### 2.2.2 Spring整合Service

spring-service.xml



##### 1.自动扫描service接口包

```xml
<!--1.扫描service下的包-->
    <context:component-scan base-package="com.test.service"/>
```



##### 2.业务类注入到Spring

```xml
    <!--2.将我们的业务类注入到Spring，可以通过配置和注解实现-->
    <!--依赖注入：set注入
        依赖：bean对象的创建依赖于容器
        注入：bean对象中的所有属性，由容器来注入-->
    <bean id="BookServiceImpl" class="com.test.service.BookServiceImpl">
        <property name="bookMapper" ref="bookMapper"/>
    </bean>
```



##### 3.声明类事务配置

```xml
 <!--3.声明类事务配置-->
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <!--注入数据源-->
        <property name="dataSource" ref="dataSource"/>
    </bean>
```



##### 4.aop事务支持



##### 完整的spring-service.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd">

<!--    <import resource="classpath:spring-dao.xml"/>-->
    <!--1.扫描service下的包-->
    <context:component-scan base-package="com.test.service"/>

    <!--2.将我们的业务类注入到Spring，可以通过配置和注解实现-->
    <!--依赖注入：set注入
        依赖：bean对象的创建依赖于容器
        注入：bean对象中的所有属性，由容器来注入-->
    <bean id="BookServiceImpl" class="com.test.service.BookServiceImpl">
        <property name="bookMapper" ref="bookMapper"/>
    </bean>

    <!--3.声明类事务配置-->
    <bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <!--注入数据源-->
        <property name="dataSource" ref="dataSource"/>
    </bean>

    <!--4.aop事务支持！-->

</beans>
```



#### 2.2.3 Spring整合Controller

spring-mvc.xml



##### 1.注解驱动

```xml
<!--1.注解驱动-->
    <mvc:annotation-driven/>
```



##### 2.静态资源过滤

```xml
<!--2.静态资源过滤-->
    <mvc:default-servlet-handler/>
```



##### 3.自动扫描controller接口包

```xml
<!--3.扫描包：controller-->
    <context:component-scan base-package="com.test.controller"/>
```



##### 4.视图解析器

```xml
    <!--4.视图解析器-->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value="/WEB-INF/jsp/"/>
        <property name="suffix" value=".jsp"/>
    </bean>
```



##### 完整spring-mvc.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/mvc
       http://www.springframework.org/schema/cache/spring-mvc.xsd
       http://www.springframework.org/schema/context
       https://www.springframework.org/schema/context/spring-context.xsd">

    <!--1.注解驱动-->
    <mvc:annotation-driven/>

    <!--2.静态资源过滤-->
    <mvc:default-servlet-handler/>

    <!--3.扫描包：controller-->
    <context:component-scan base-package="com.test.controller"/>

    <!--4.视图解析器-->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value="/WEB-INF/jsp/"/>
        <property name="suffix" value=".jsp"/>
    </bean>

</beans>
```



> 注意：
>
> - 配置时的约束注意结尾为mvc, 同时, .xsd中间也要改成mvc
> - 视图解析器配置前缀时注意开头和结尾的 /
> - 如果要使用JackSon, 在此处配置解决乱码问题



### 2.3 SpringMVC

增加web项目支持

web/WEB-INF/web.xml



servlet都需要mapping一下

#### 1.配置DispatchServlet

```xml
    <!--1.DispatchServlet-->
    <servlet>
        <servlet-name>springmvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
            <param-value>classpath:spring-mvc.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>

    <!--所有请求都应该被springmvc拦截，即DispatcherServlet -->
    <servlet-mapping>
        <servlet-name>springmvc</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>
```



#### 2.乱码过滤

```xml
    <!--2.乱码过滤-->
    <filter>
        <filter-name>encodingFilter</filter-name>
        <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>utf-8</param-value>
        </init-param>
    </filter>

    <filter-mapping>
        <filter-name>encodingFilter</filter-name>
        <!--只有/解决不了页面的乱码-->
        <url-pattern>/*</url-pattern>
    </filter-mapping>
```



#### 3.session时间

```xml
    <!--Session,配置session过期时间-->
    <session-config>
        <session-timeout>15</session-timeout>
    </session-config>
```



#### 完整的web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd"
         version="4.0">

    <!--DispatcherServlet-->
    <servlet>
        <servlet-name>springmvc</servlet-name>
        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
        <init-param>
            <param-name>contextConfigLocation</param-name>
<!--            直接写成spring-mvc会有问题-->
            <param-value>classpath:applicationContext.xml</param-value>
        </init-param>
        <load-on-startup>1</load-on-startup>
    </servlet>
    <servlet-mapping>
        <servlet-name>springmvc</servlet-name>
        <url-pattern>/</url-pattern>
    </servlet-mapping>

    <!--乱码过滤-->
    <filter>
        <filter-name>encodingFilter</filter-name>
        <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
        <init-param>
            <param-name>encoding</param-name>
            <param-value>utf-8</param-value>
        </init-param>
    </filter>
    <filter-mapping>
        <filter-name>encodingFilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping>

    <!--Session:    配置Session过期时间为15分钟-->
    <session-config>
        <session-timeout>15</session-timeout>
    </session-config>

</web-app>

```



=>让spring去整合controller（也就是MVC）

对应2.2.3



#### 4.添加并配置Tomcat

在项目结构下的Artfact中, 添加一个lib目录, 将所有的库放入这个lib目录下



#### 如果出现bean不存在的排错思路

1. 查看这个bean是否注入成功! ==> idea中能跳转则成功

   ![image-20220518010815666](appendix\6. 整合SSM\image-20220518010815666.png)

2. Junit单元测试, 看我们的代码是否能查询出结果!

   ```java
   public class MyTest {
       @Test
       public void test(){
           ApplicationContext context = new ClassPathXmlApplicationContext("applicationContext.xml");
           BookService bookServiceImpl = (BookService)context.getBean("BookServiceImpl");
           for (Books books : bookServiceImpl.queryAllBook()) {
               System.out.println(books);
           }
       }
   }
   ```

   ![image-20220518010912216](appendix\6. 整合SSM\image-20220518010912216.png)

3. 如果上面都没有问题, 则问题一定不在我们的底层, 是Spring出了问题!

4. SpringMVC, 整合的时候没有调用我们的service层的bean:

   1. applicationContext.xml 没有注入bean

   2. web.xml中, 我们也绑定过配置文件! 看配置文件是否绑全!

      问题在于我们配置的是spring-mvc.xml，这里确实没有service bean  ，所以报空指针异常，应该改成applicationContext.xml



#### 5.实现查询全部书籍

##### 5.1在controller中添加功能

controller/BookController.java

```java
package com.test.controller;

import com.test.pojo.Books;
import com.test.service.BookService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;

@Controller
@RequestMapping("/book")
public class BookController {

    //controller层 调 service 层
    //这里使用Qualified, 指定了注入BookServiceImpl, 避免了自动装配注入对象模糊的问题
    private final BookService bookService;

    public BookController(@Qualifier("BookServiceImpl") BookService bookService) {
        this.bookService = bookService;
    }

    //查询全部的书籍, 并且返回到一个书籍展示页面
    @RequestMapping("/allBook")
    public String list(Model model) {
        List<Books> list = bookService.queryAllBook();

        model.addAttribute("list", list);
        return "allBook";
    }

}
```



##### 5.2 修改并美化主页

index.jsp

```jsp
<%--
  Created by IntelliJ IDEA.
  User: Wang
  Date: 2020/9/9
  Time: 16:40
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
  <head>
    <title>首页</title>

    <style>
      a {
        text-decoration: none;
        color: black;
        font-size: 18px;
      }
      h3 {
        width: 180px;
        height: 38px;
        margin: 100px auto;
        text-align: center;
        line-height: 38px;
        background: deepskyblue;
        border-radius: 5px;
      }
    </style>

  </head>
  <body>

  <h3>
    <%--此处要写${pageContext.request.contextPath}  后面的写绝对地址, 方便项目运行!--%>
    <a href="${pageContext.request.contextPath}/book/allBook">进入到书籍页面</a>
  </h3>

  </body>
</html>

```



##### 5.3利用BootStrap和jstl美化并完成书籍查询页面

BootStrap可视化布局系统

/WEB-INF/jsp/allBook.jsp

```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%--
  Created by IntelliJ IDEA.
  User: Wang
  Date: 2020/9/9
  Time: 17:23
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>书籍展示</title>

    <%--BootStrap美化页面--%>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>

<%--栅格--%>
<div class="container">
    <%--清除浮动--%>
    <div class="row clearfix">
        <%--分屏12份--%>
        <div class="col-md-12">
            <div class="page-header">
                <h1>
                    <small>
                        书籍列表 —————————————————— 显示所有书籍
                    </small>
                </h1>
            </div>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-md-12">
            <table class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th>书籍编号</th>
                        <th>书籍名称</th>
                        <th>书籍数量</th>
                        <th>书籍详情</th>
                    </tr>
                </thead>

                <%--书籍从数据库中查询出来, 从这个list遍历出来 : foreach--%>
                <tbody>
                    <c:forEach var="book" items="${list}">
                        <tr>
                            <td>${book.bookID}</td>
                            <td>${book.bookName}</td>
                            <td>${book.bookCounts}</td>
                            <td>${book.detail}</td>
                        </tr>
                    </c:forEach>
                </tbody>
            </table>
        </div>
    </div>
</div>

</body>
</html>

```



#### 6. 实现添加书籍

##### 6.1在查询所有书籍的页面中添加跳转添加书籍的按钮

/WEB-INF/jsp/allBook.jsp

```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%--
  Created by IntelliJ IDEA.
  User: Wang
  Date: 2020/9/9
  Time: 17:23
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>书籍展示</title>

    <%--BootStrap美化页面--%>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>

<%--栅格--%>
<div class="container">
    <%--清除浮动--%>
    <div class="row clearfix">
        <%--分屏12份--%>
        <div class="col-md-12">
            <div class="page-header">
                <h1>
                    <small>
                        书籍列表 —————————————————— 显示所有书籍
                    </small>
                </h1>
            </div>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-md-12">
            <table class="table table-hover table-striped">
                <thead>
                <tr>
                    <th>书籍编号</th>
                    <th>书籍名称</th>
                    <th>书籍数量</th>
                    <th>书籍详情</th>
                </tr>
                </thead>

                <%--书籍从数据库中查询出来, 从这个list遍历出来 : foreach--%>
                <tbody>
                <c:forEach var="book" items="${list}">
                    <tr>
                        <td>${book.bookID}</td>
                        <td>${book.bookName}</td>
                        <td>${book.bookCounts}</td>
                        <td>${book.detail}</td>
                    </tr>
                </c:forEach>
                </tbody>
            </table>
        </div>
    </div>

    <%--增加书籍的按钮--%>
    <div class="row clearfix">
        <div class="row">
            <div class="col-md-4 column">
                <%--toAddBook--%>
                <a href="${pageContext.request.contextPath}/book/toAddBook" class="btn btn-primary">
                    新增书籍
                </a>
            </div>
        </div>
    </div>
</div>

</body>
</html>

```

##### 6.2在controller中添加跳转和添加的功能

controller/BookController.java

```java
package com.test.controller;

import com.test.pojo.Books;
import com.test.service.BookService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;

@Controller
@RequestMapping("/book")
public class BookController {

    //controller层 调 service 层
    //这里使用Qualified, 指定了注入BookServiceImpl, 避免了自动装配注入对象模糊的问题
    private final BookService bookService;

    public BookController(@Qualifier("BookServiceImpl") BookService bookService) {
        this.bookService = bookService;
    }

    //查询全部的书籍, 并且返回到一个书籍展示页面
    @RequestMapping("/allBook")
    public String list(Model model) {
        List<Books> list = bookService.queryAllBook();

        model.addAttribute("list", list);
        return "allBook";
    }

    @RequestMapping("/toAddBook")
    public String toAddPage(){
        return "addBook";
    }

    //添加书籍的请求
    @RequestMapping("/addBook")
    public String addBook(Books books){
        System.out.println("addBook=>" + books);
        bookService.addBook(books);
        return "redirect:/book/allBook";
    }


}

```

注意

- 在jsp中添加了点击会跳转到/book/toAddBook的按钮, 这里会进一步跳转到addBook页面
- /book/addBook是添加书籍的地址, 表单要提交到这里来处理!
- 添加之后, 要重定向到查询全部书籍, 使用 return "redirect:/book/allBook";



##### 6.3设计添加书籍的页面

/WEB-INF/jsp/addBook.jsp

```jsp
<%--
  Created by IntelliJ IDEA.
  User: Wang
  Date: 2020/9/10
  Time: 14:00
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>新增书籍</title>

    <%--BootStrap美化页面--%>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>

<%--栅格--%>
<div class="container">
    <%--清除浮动--%>
    <div class="row clearfix">
        <%--分屏12份--%>
        <div class="col-md-12">
            <div class="page-header">
                <h1>
                    <small>
                        书籍列表 —————————————————— 新增书籍
                    </small>
                </h1>
            </div>
        </div>
    </div>

    <form action="${pageContext.request.contextPath}/book/addBook" method="post">
        <div class="form-group">
            <%--此处的label中的for标签对应下面input标签中的id, 这样点击label就可以直接到input!--%>
            <label for="bookName">书籍名称:</label>
            <%--input中的name要与实体类中的一致!--%>
            <input type="text" class="form-control" id="bookName" name="bookName" required>
        </div>
        <div class="form-group">
            <label for="bookCounts">书籍数量:</label>
            <input type="text" class="form-control" id="bookCounts" name="bookCounts" required>
        </div>
        <div class="form-group">
            <label for="detail">书籍描述:</label>
            <input type="text" class="form-control" id="detail" name="detail" required>
        </div>
        <div class="form-group">
            <input type="submit" class="form-control" value="添加">
        </div>
    </form>

</div>

</body>
</html>

```

注意

- label中的for标签对应下面input标签中的id, 这样点击label就可以直接到input
- form表单中, 各个标签的name属性的值为后端取到的属性的名称(getParameter("XXX")).submit提交后,我们使用Mybatis和SpringMVC可以直接取出其中的值(返回的属性会封装在对象中)
- input name属性要与pojo中的属性名完全一致!



#### 7.修改和删除书籍

##### 7.1修改书籍查询页面

/WEB-INF/jsp/allBook.jsp

```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%--
  Created by IntelliJ IDEA.
  User: Wang
  Date: 2020/9/9
  Time: 17:23
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>书籍展示</title>

    <%--BootStrap美化页面--%>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>

<%--栅格--%>
<div class="container">
    <%--清除浮动--%>
    <div class="row clearfix">
        <%--分屏12份--%>
        <div class="col-md-12">
            <div class="page-header">
                <h1>
                    <small>
                        书籍列表 —————————————————— 显示所有书籍
                    </small>
                </h1>
            </div>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-md-12">
            <table class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th>书籍编号</th>
                        <th>书籍名称</th>
                        <th>书籍数量</th>
                        <th>书籍详情</th>
                        <th>操作</th>
                    </tr>
                </thead>

                <%--书籍从数据库中查询出来, 从这个list遍历出来 : foreach--%>
                <tbody>
                    <c:forEach var="book" items="${list}">
                        <tr>
                            <td>${book.bookID}</td>
                            <td>${book.bookName}</td>
                            <td>${book.bookCounts}</td>
                            <td>${book.detail}</td>
                            <td>
                                <%--通过a标签携带参数 ==> 使用?参数名=${参数值}--%>
                                <a href="${pageContext.request.contextPath}/book/toUpdateBook?id=${book.bookID}">修改</a>
                                &nbsp; | &nbsp;
                                <%--通过a标签携带参数 ==> 此处使用RestFul风格--%>
                                <a href="${pageContext.request.contextPath}/book/deleteBook/${book.bookID}">删除</a>
                            </td>
                        </tr>
                    </c:forEach>
                </tbody>
            </table>
        </div>
    </div>

    <%--增加书籍的按钮--%>
    <div class="row clearfix">
        <div class="row">
            <div class="col-md-4 column">
                <%--toAddBook--%>
                <a href="${pageContext.request.contextPath}/book/toAddBook" class="btn btn-primary">
                    新增书籍
                </a>
            </div>
        </div>
    </div>
</div>

</body>
</html>

```

注意

- 前端向后端传递参数, 如果不是表单的话, 通过a标签, 携带参数的URL

##### 7.2在controller中添加跳转和修改以及删除的功能

controller/BookController.java

```java
package com.test.controller;

import com.test.pojo.Books;
import com.test.service.BookService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;

@Controller
@RequestMapping("/book")
public class BookController {

    //controller层 调 service 层
    //这里使用Qualified, 指定了注入BookServiceImpl, 避免了自动装配注入对象模糊的问题
    private final BookService bookService;

    public BookController(@Qualifier("BookServiceImpl") BookService bookService) {
        this.bookService = bookService;
    }

    //查询全部的书籍, 并且返回到一个书籍展示页面
    @RequestMapping("/allBook")
    public String list(Model model) {
        List<Books> list = bookService.queryAllBook();

        model.addAttribute("list", list);
        return "allBook";
    }

    @RequestMapping("/toAddBook")
    public String toAddPage(){
        return "addBook";
    }

    //添加书籍的请求
    @RequestMapping("/addBook")
    public String addBook(Books books){
        System.out.println("addBook=>" + books);
        bookService.addBook(books);
        return "redirect:/book/allBook";
    }

    //添加书籍的请求
    @RequestMapping("/toUpdateBook")
    public String toUpdatePage(int id,Model model){
        Books books = bookService.queryBookById(id);
        model.addAttribute("queryResult",books);
        return "updateBook";
    }

    //修改书籍
    @RequestMapping("/updateBook")
    public String updatePage(Books books){
        System.out.println("updateBook=>"+books);
        bookService.updateBook(books);
        return "redirect:/book/allBook";
    }

    //删除书籍
    @RequestMapping("/deleteBook/{bookId}")
    //restful风格
    public String deleteBook(@PathVariable("bookId") int id){
        System.out.println("deleteBook=>"+id);
        bookService.deleteBookById(id);
        return "redirect:/book/allBook";
    }
}

```



注意

- 由于前端使用url向后端传递了参数, 保证属性名一致的情况下可以直接取到

- Model对象用于将后端处理的结果传递给前端(相当于setAttribute), 这里使用addAtrribute("属性名", 对象)方法, 在前端使用${"属性名"}即可取出!

- 修改后发现数据库和页面都没有生效（除了查询之外的操作都需要事务提交），说明需要事务提交，利用AOP的方式。（最后发现事务是正常的，不需要配置）

  ![image-20220519010143612](appendix\6. 整合SSM\image-20220519010143612.png)

##### 7.3设计修改书籍的页面

/WEB-INF/jsp/updateBook.jsp

```jsp
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%--
  Created by IntelliJ IDEA.
  User: Wang
  Date: 2020/9/10
  Time: 15:17
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>修改书籍</title>

    <%--BootStrap美化页面--%>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>

<%--栅格--%>
<div class="container">
    <%--清除浮动--%>
    <div class="row clearfix">
        <%--分屏12份--%>
        <div class="col-md-12">
            <div class="page-header">
                <h1>
                    <small>
                        书籍列表 —————————————————— 修改书籍
                    </small>
                </h1>
            </div>
        </div>
    </div>

    <form action="${pageContext.request.contextPath}/book/updateBook" method="post">
        <div class="form-group">
            <%--此处的label中的for标签对应下面input标签中的id, 这样点击label就可以直接到input!--%>
            <label for="bookName">书籍名称:</label>
            <%--input中的name要与实体类中的一致!--%>
            <%--value为文本框中显示的值, 这里从后台返回的对象中取出对应的字段--%>
            <input type="text" class="form-control" id="bookName" name="bookName" value="${queryResult.bookName}" required>
        </div>
        <div class="form-group">
            <label for="bookCounts">书籍数量:</label>
            <input type="text" class="form-control" id="bookCounts" name="bookCounts" value="${queryResult.bookCounts}" required>
        </div>
        <div class="form-group">
            <label for="detail">书籍描述:</label>
            <input type="text" class="form-control" id="detail" name="detail" value="${queryResult.detail}" required>
        </div>
        <div class="form-group">
            <input type="submit" class="form-control" value="修改">
        </div>
        <%--此处修改要传递bookID, 同时此属性不应该被修改, 因此要使用隐藏域--%>
        <input type="hidden" name="bookID" value="${queryResult.bookID}">
    </form>


</div>

</body>
</html>

```

注意

- input标签中, value为文本框中显示的值

- 需要从前端传递到后端但是不想让用户看到的值, 使用隐藏域

  ```jsp
  Copy<%--此处修改要传递bookID, 同时此属性不应该被修改, 因此要使用隐藏域--%>
  <input type="hidden" name="bookID" value="${queryResult.bookID}">
  ```

#### 8.新增搜索功能

添加一个通过书籍名称搜索书籍的功能

设计思路从下到上(dao ---> service ---> controller), 这样就方便修改

![image-20220519013038275](appendix\6. 整合SSM\image-20220519013038275.png)

##### 8.1修改前端页面

/WEB-INF/jsp/allBook.jsp

```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%--
  Created by IntelliJ IDEA.
  User: Wang
  Date: 2020/9/9
  Time: 17:23
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>书籍展示</title>

    <%--BootStrap美化页面--%>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>

<%--栅格--%>
<div class="container">
    <%--清除浮动--%>
    <div class="row clearfix">
        <%--分屏12份--%>
        <div class="col-md-12">
            <div class="page-header">
                <h1>
                    <small>
                        书籍列表 —————————————————— 显示所有书籍
                    </small>
                </h1>
            </div>
        </div>
    </div>

    <div class="row clearfix">
        <div class="col-md-12">
            <table class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th>书籍编号</th>
                        <th>书籍名称</th>
                        <th>书籍数量</th>
                        <th>书籍详情</th>
                        <th>操作</th>
                    </tr>
                </thead>

                <%--书籍从数据库中查询出来, 从这个list遍历出来 : foreach--%>
                <tbody>
                    <c:forEach var="book" items="${list}">
                        <tr>
                            <td>${book.bookID}</td>
                            <td>${book.bookName}</td>
                            <td>${book.bookCounts}</td>
                            <td>${book.detail}</td>
                            <td>
                                <%--通过a标签携带参数 ==> 使用?参数名=${参数值}--%>
                                <a href="${pageContext.request.contextPath}/book/toUpdateBook?id=${book.bookID}">修改</a>
                                &nbsp; | &nbsp;
                                <%--通过a标签携带参数 ==> 此处使用RestFul风格--%>
                                <a href="${pageContext.request.contextPath}/book/deleteBook/${book.bookID}">删除</a>
                            </td>
                        </tr>
                    </c:forEach>
                </tbody>
            </table>
        </div>
    </div>

    <%--增加书籍的按钮--%>
    <div class="row clearfix">
        <div class="row">
            <div class="col-md-4 column">
                <%--toAddBook--%>
                <a href="${pageContext.request.contextPath}/book/toAddBook" class="btn btn-primary">
                    新增书籍
                </a>

                <%--显示全部书籍--%>
                <a href="${pageContext.request.contextPath}/book/allBook" class="btn btn-primary">
                    显示全部书
                </a>
            </div>

            <div class="col-md-4 column"></div>

            <div class="col-md-8 column">
                <%--查询书籍, style="float: right"为向右浮动--%>
                <form action="${pageContext.request.contextPath}/book/queryBook" method="post" style="float: right" class="form-inline">
                    <span style="color: red; font-weight: bold">${error}</span>
                    <%--placeholder为默认显示的值--%>
                    <input type="text" placeholder="请输入要查询的书籍" class="form-control" name="queryBookName">
                    <input type="submit" value="查询" class="btn btn-primary">
                </form>
            </div>
        </div>
    </div>
</div>

</body>
</html>

```

注意

- 如果想要贴边, 需要写浮动 style="float: right"



##### 8.2在Dao层添加功能

dao/BookMapper.java

```java
package com.test.dao;

import com.test.pojo.Books;
import org.apache.ibatis.annotations.Param;

import java.util.List;

public interface BookMapper {

    //增加一本书
    int addBook(Books books);

    //删除一本书
    int deleteBookById(@Param("bookID") int id);

    //更新一本书
    int updateBook(Books books);

    //查询一本书
    Books queryBookById(@Param("bookID") int id);

    //查询全部的书
    List<Books> queryAllBook();

    Books queryBookByName(@Param("bookName") String bookName);

}

```



dao/BookMapper.xml

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test.dao.BookMapper">

    <insert id="addBook" parameterType="Books">
        insert into SSMBuild.books (bookName, bookCounts, detail)
        VALUES (#{bookName}, #{bookCounts}, #{detail});
    </insert>

    <delete id="deleteBookById" parameterType="_int">
        delete from SSMBuild.books where bookID = #{bookID};
    </delete>

    <update id="updateBook" parameterType="Books">
        update SSMBuild.books
        set bookName = #{bookName}, bookCounts = #{bookCounts}, detail = #{detail}
        where bookID = #{bookID};
    </update>

    <select id="queryBookById" resultType="Books">
        select * from SSMBuild.books where bookID = #{bookID};
    </select>

    <!--没有一对多和多对一 所以返回值还是Books-->
    <select id="queryAllBook" resultType="Books">
        select * from SSMBuild.books;
    </select>

    <select id="queryBookByName" resultType="Books">
        select * from SSMBuild.books where bookName=#{bookName}
    </select>

</mapper>
```



##### 8.3在Service层添加功能

service/BookService.java

```java
package com.test.service;

import com.test.pojo.Books;
import org.apache.ibatis.annotations.Param;

import java.util.List;

public interface BookService {
    //增加一本书
    int addBook(Books books);

    //删除一本书
    int deleteBookById(int id);

    //更新一本书
    int updateBook(Books books);

    //查询一本书
    Books queryBookById(int id);

    //查询全部的书
    List<Books> queryAllBook();

    Books queryBookByName(String bookName);
}

```



service/BookServiceImpl.java

```java
package com.test.service;

import com.test.dao.BookMapper;
import com.test.pojo.Books;

import java.util.List;

public class BookServiceImpl implements BookService{

    //service层 调 dao层: 组合dao
    private BookMapper bookMapper;

    //添加setter, Spring可以直接注入到mapper
    public void setBookMapper(BookMapper bookMapper) {
        this.bookMapper = bookMapper;
    }

    @Override
    public int addBook(Books books) {
        return bookMapper.addBook(books);
    }

    @Override
    public int deleteBookById(int id) {
        return bookMapper.deleteBookById(id);
    }

    @Override
    public int updateBook(Books books) {
        System.out.println("BookServiceImpl:updateBook=>"+books);
        return bookMapper.updateBook(books);
    }

    @Override
    public Books queryBookById(int id) {
        return bookMapper.queryBookById(id);
    }

    @Override
    public List<Books> queryAllBook() {
        return bookMapper.queryAllBook();
    }

    @Override
    public Books queryBookByName(String bookName) {
        return bookMapper.queryBookByName(bookName);
    }


}

```



##### 8.4在Controller层添加功能

controller/BookController.java

```java
package com.test.controller;

import com.test.pojo.Books;
import com.test.service.BookService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.ArrayList;
import java.util.List;

@Controller
@RequestMapping("/book")
public class BookController {

    //controller层 调 service 层
    //这里使用Qualified, 指定了注入BookServiceImpl, 避免了自动装配注入对象模糊的问题
    private final BookService bookService;

    public BookController(@Qualifier("BookServiceImpl") BookService bookService) {
        this.bookService = bookService;
    }

    //查询全部的书籍, 并且返回到一个书籍展示页面
    @RequestMapping("/allBook")
    public String list(Model model) {
        List<Books> list = bookService.queryAllBook();

        model.addAttribute("list", list);
        return "allBook";
    }

    @RequestMapping("/toAddBook")
    public String toAddPage(){
        return "addBook";
    }

    //添加书籍的请求
    @RequestMapping("/addBook")
    public String addBook(Books books){
        System.out.println("addBook=>" + books);
        bookService.addBook(books);
        return "redirect:/book/allBook";
    }

    //添加书籍的请求
    @RequestMapping("/toUpdateBook")
    public String toUpdatePage(int id,Model model){
        Books books = bookService.queryBookById(id);
        model.addAttribute("queryResult",books);
        return "updateBook";
    }

    //修改书籍
    @RequestMapping("/updateBook")
    public String updatePage(Books books){
        System.out.println("updateBook=>"+books);
        bookService.updateBook(books);
        return "redirect:/book/allBook";
    }

    //删除书籍
    @RequestMapping("/deleteBook/{bookId}")
    //restful风格
    public String deleteBook(@PathVariable("bookId") int id){
        System.out.println("deleteBook=>"+id);
        bookService.deleteBookById(id);
        return "redirect:/book/allBook";
    }

    //查询书籍
    @RequestMapping("/queryBook")
    public String queryBook(String queryBookName,Model model){
        Books books = bookService.queryBookByName(queryBookName);
        List<Books> list = new ArrayList<>();
        list.add(books);

        //如果查询不存在, 返回全部书籍
        if(books == null) {
            list = bookService.queryAllBook();
            model.addAttribute("error", "未查到该书籍");
        }
        model.addAttribute("list", list);
        return "/allBook";
    }
}

```

注意

- 为了复用查询的前端页面, 这里将查询结果封装为list, 传回前端页面即可使用!
- 这里存在查询不存在的情况, 要考虑查询失败的响应
- 失败后, 如果想返回全部的列表, 只需要将list放入全部书籍即可



## 3. 梳理SSM整合目录

**1.x mybatis：**

- 定义并实现dao, service(model)的操作

  >**业务层调dao层**，组合Dao，也就是把数据填进去
  >
  >dao的实现类：dao调sql，
  >
  >service的实现类：service调dao，把数据填入实现类的属性中（bookMapper）,这块要定义setter方法，spring才能注入

**2.x spring：**

- 整合dao(连接数据库), service, mvc(controller)

**3.x mvc：**

- web支持（controller）

  >controller调service层

```xml
│  pom.xml    ===>  0 导入依赖 + 资源                    
├─src
│  ├─main
│  │  ├─java
│  │  │  └─com
│  │  │      └─test
│  │  │          ├─controller
│  │  │          ├─dao
│  │  │          │      BookMapper.java    ===>  1.2-1 定义实体类对象操作（接口）
│  │  │          │      BookMapper.xml    ===>  1.2-2 实现实体类对象操作（接口）【写sql语句】
│  │  │          │      BookMapperImpl.java    ===>  （已被2.1替代）实现实体类对象操作（类）【利用sqlSessionTemplate获取执行sql语句的对象】
│  │  │          │      
│  │  │          ├─pojo
│  │  │          │      Books.java     ===>  1.1 定义实体类对象的结构
│  │  │          │      
│  │  │          └─service
│  │  │                  BookService.java     ===>  1.3-1 定义业务层功能操作（接口）【与dao层一致】
│  │  │                  BookServiceImpl.java     ===>  1.3-2 实现业务层功能（接口）
│  │  │                  
│  │  └─resources
│  │          applicationContext.xml     ===>  2 import spring的所有xml
│  │          database.properties     ===>  2.1-1 关联数据配置文件
│  │          mybatis-config.xml     ===>  1 配置mybatis-config.xml【设置别名、mapper映射】
│  │          spring-dao.xml     ===>  2.1 spring整合dao层【数据连接、获取执行sql语句的对象】
│  │          spring-mvc.xml     ===>  2.3 spring整合controller（mvc）层
│  │          spring-service.xml     ===>  2.2 spring整合service层
│  │          
│  └─test
│      └─java
└─web
    │  index.jsp
    │  
    └─WEB-INF
        │  web.xml     ===>  3 配置SpringMVC
        │  
        └─jsp

```





